<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Secure PDF Vault</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Identity Services (OAuth) -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- React 18 UMD - Core Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background: #f8fafc;
            margin: 0; 
            padding: 0; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .animate-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "@heroicons/react/": "https://esm.sh/@heroicons/react@^2.2.0/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script>
        // Access React from the window global (provided by UMD scripts)
        const { useState, useRef, createElement: h } = window.React;

        // --- CONFIGURATION ---
        const CLIENT_ID = '434749072442-pg90mkbopnkqvrd2lcpoonsr8qbjp7eb.apps.googleusercontent.com';
        const SCOPE = 'https://www.googleapis.com/auth/drive.file';
        const DEFAULT_FOLDER_ID = '1-WLf0BCcsZ_hZoTxTUAta7ZDI-iEDQV9';

        // --- ICONS (SVG Helpers) ---
        const IconCheck = (p) => h('svg', { ...p, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2.5 }, h('path', { d: "M5 13l4 4L19 7" }));
        const IconDoc = (p) => h('svg', { ...p, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 }, h('path', { d: "M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" }));
        const IconCog = (p) => h('svg', { ...p, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 }, h('path', { d: "M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" }));
        const IconClose = (p) => h('svg', { ...p, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 }, h('path', { d: "M6 18L18 6M6 6l12 12" }));
        const IconCloud = (p) => h('svg', { ...p, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 }, h('path', { d: "M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v8" }));

        const App = () => {
            const [state, setState] = useState({
                file: null,
                isUploading: false,
                error: null,
                success: null,
                folderId: localStorage.getItem('v_fid') || DEFAULT_FOLDER_ID
            });
            const [showSettings, setShowSettings] = useState(false);
            const fileInputRef = useRef(null);

            const uploadToDrive = async (file, token) => {
                const metadata = { name: file.name, parents: [state.folderId] };
                const reader = new FileReader();
                const base64 = await new Promise((res) => {
                    reader.onload = () => res(reader.result.split(',')[1]);
                    reader.readAsDataURL(file);
                });

                const boundary = '-------3141592653589';
                const body = `--${boundary}\nContent-Type: application/json\n\n${JSON.stringify(metadata)}\n--${boundary}\nContent-Type: ${file.type}\nContent-Transfer-Encoding: base64\n\n${base64}\n--${boundary}--`;

                const res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: { Authorization: `Bearer ${token}`, 'Content-Type': `multipart/related; boundary=${boundary}` },
                    body: body
                });

                if (!res.ok) throw new Error("Upload failed. Verify GitHub URL is authorized in Cloud Console.");
                return res.json();
            };

            const handleAction = async () => {
                setState(s => ({ ...s, isUploading: true, error: null, success: null }));
                try {
                    const token = await new Promise((res, rej) => {
                        const client = window.google.accounts.oauth2.initTokenClient({
                            client_id: CLIENT_ID,
                            scope: SCOPE,
                            callback: (r) => r.error ? rej(new Error(r.error_description)) : res(r.access_token)
                        });
                        client.requestAccessToken();
                    });
                    await uploadToDrive(state.file, token);
                    setState(s => ({ ...s, isUploading: false, file: null, success: "Transfer Complete!" }));
                } catch (err) {
                    setState(s => ({ ...s, isUploading: false, error: err.message }));
                }
            };

            return h('div', { className: 'w-full max-w-md p-4 animate-in' },
                h('div', { className: 'bg-white rounded-[3rem] shadow-2xl overflow-hidden border border-slate-100' },
                    
                    // HEADER
                    h('div', { className: 'bg-slate-900 px-8 py-10 flex justify-between items-start text-white relative' },
                        h('div', null,
                            h('h1', { className: 'text-2xl font-black uppercase tracking-tight' }, 'Secure Vault'),
                            h('p', { className: 'text-[10px] text-slate-500 font-black uppercase tracking-widest mt-1' }, state.isUploading ? 'Transferring File...' : 'Encrypted Connection')
                        ),
                        h('button', { onClick: () => setShowSettings(true), className: 'p-2 hover:bg-white/10 rounded-xl transition-all' }, h(IconCog, { className: 'w-6 h-6 text-slate-400' }))
                    ),

                    // MAIN AREA
                    h('div', { className: 'p-10 min-h-[360px] relative' },
                        
                        // Settings Overlay
                        showSettings && h('div', { className: 'absolute inset-0 bg-white z-50 p-10 animate-in' },
                            h('div', { className: 'flex justify-between items-center mb-8' }, 
                                h('h2', { className: 'font-black text-xl' }, 'Settings'),
                                h('button', { onClick: () => setShowSettings(false) }, h(IconClose, { className: 'w-6 h-6 text-slate-300' }))
                            ),
                            h('label', { className: 'text-[10px] font-black uppercase text-slate-400 mb-2 block' }, 'Target Folder ID'),
                            h('input', { 
                                className: 'w-full p-4 bg-slate-50 border rounded-2xl mb-8 font-mono text-xs outline-none focus:ring-2 focus:ring-blue-500',
                                defaultValue: state.folderId,
                                onChange: (e) => {
                                    const val = e.target.value.trim() || DEFAULT_FOLDER_ID;
                                    localStorage.setItem('v_fid', val);
                                    setState(s => ({ ...s, folderId: val }));
                                }
                            }),
                            h('button', { onClick: () => setShowSettings(false), className: 'w-full py-5 bg-slate-900 text-white font-black rounded-2xl' }, 'Save & Close')
                        ),

                        // Error / Success Messages
                        state.error && h('div', { className: 'mb-6 p-4 bg-rose-50 border border-rose-100 text-rose-600 rounded-2xl text-[10px] font-black uppercase tracking-tight' }, state.error),
                        state.success && h('div', { className: 'mb-6 p-6 bg-emerald-50 border border-emerald-100 text-emerald-700 rounded-2xl flex items-center gap-4' }, h(IconCheck, { className: 'w-6 h-6 text-emerald-500' }), h('span', { className: 'font-black uppercase text-xs' }, state.success)),

                        // Drag & Drop / Selection Area
                        !state.file ? h('div', { 
                            onClick: () => fileInputRef.current.click(),
                            className: 'border-2 border-dashed border-slate-200 rounded-[2.5rem] p-16 text-center cursor-pointer hover:bg-slate-50 hover:border-blue-500 transition-all group'
                        },
                            h(IconCloud, { className: 'w-16 h-16 text-slate-200 mx-auto mb-6 group-hover:text-blue-600 transition-colors duration-300' }),
                            h('p', { className: 'text-[10px] font-black uppercase text-slate-400 tracking-[0.2em]' }, 'Choose PDF to Secure'),
                            h('input', { type: 'file', ref: fileInputRef, className: 'hidden', accept: '.pdf', onChange: (e) => {
                                if (e.target.files[0]) setState(s => ({ ...s, file: e.target.files[0], error: null, success: null }));
                            }})
                        ) : h('div', { className: 'space-y-4' },
                            h('div', { className: 'p-6 bg-slate-50 rounded-2xl flex items-center gap-5 border border-slate-100 shadow-sm' },
                                h(IconDoc, { className: 'w-8 h-8 text-blue-600' }),
                                h('div', { className: 'flex-1 min-w-0' },
                                    h('p', { className: 'font-black truncate text-sm text-slate-900' }, state.file.name),
                                    h('p', { className: 'text-[9px] font-black text-slate-400 uppercase tracking-widest mt-1' }, (state.file.size / 1024 / 1024).toFixed(2) + ' MB')
                                ),
                                !state.isUploading && h('button', { onClick: () => setState(s => ({ ...s, file: null })) }, h(IconClose, { className: 'w-5 h-5 text-slate-300 hover:text-rose-500' }))
                            ),
                            h('button', { 
                                onClick: handleAction,
                                disabled: state.isUploading,
                                className: `w-full py-6 rounded-2xl font-black text-white shadow-xl transition-all active:scale-95 ${state.isUploading ? 'bg-slate-200 text-slate-400' : 'bg-blue-600 hover:bg-blue-700'}`
                            }, state.isUploading ? 'Authorizing Tunnel...' : 'Upload to Drive')
                        )
                    ),

                    // FOOTER
                    h('div', { className: 'px-10 py-8 bg-slate-50 border-t flex justify-between items-center' },
                        h('div', { className: 'flex items-center gap-2' },
                            h('div', { className: 'w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]' }),
                            h('p', { className: 'text-[8px] font-black text-slate-400 uppercase tracking-widest' }, 'Vault Active')
                        ),
                        h('span', { className: 'text-[8px] font-black text-slate-300' }, 'v1.1.2')
                    )
                )
            );
        };

        // Initialize React Application
        const root = window.ReactDOM.createRoot(document.getElementById('root'));
        root.render(h(App));
    </script>
</body>
</html>
